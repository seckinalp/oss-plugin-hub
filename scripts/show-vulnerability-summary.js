#!/usr/bin/env node

import fs from 'fs';

console.log('\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
console.log('â•‘     VULNERABILITY DATA ENRICHMENT SUMMARY                  â•‘');
console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

const platforms = ['chrome', 'firefox', 'homeassistant', 'jetbrains', 'minecraft', 'obsidian', 'sublime', 'vscode', 'wordpress'];

let totalCritical = 0;
let totalHigh = 0;
let totalMedium = 0;
let totalLow = 0;
let totalClean = 0;

platforms.forEach(p => {
  const data = JSON.parse(fs.readFileSync(`data/${p}/top100.json`, 'utf8'));
  
  const critical = data.top100.filter(plugin => plugin.vulnerabilityAnalysis?.riskLevel === 'critical').length;
  const high = data.top100.filter(plugin => plugin.vulnerabilityAnalysis?.riskLevel === 'high').length;
  const medium = data.top100.filter(plugin => plugin.vulnerabilityAnalysis?.riskLevel === 'medium').length;
  const low = data.top100.filter(plugin => plugin.vulnerabilityAnalysis?.riskLevel === 'low').length;
  const clean = data.top100.filter(plugin => plugin.vulnerabilityAnalysis?.riskLevel === 'clean').length;
  
  totalCritical += critical;
  totalHigh += high;
  totalMedium += medium;
  totalLow += low;
  totalClean += clean;
  
  console.log(`${p}:`);
  console.log(`  ğŸ”´ Critical: ${critical}`);
  console.log(`  ğŸŸ  High: ${high}`);
  console.log(`  ğŸŸ¡ Medium: ${medium}`);
  console.log(`  ğŸŸ¢ Low: ${low}`);
  console.log(`  âœ… Clean: ${clean}`);
  console.log(`  Status: ${data.metadata.vulnerabilityAnalysis.analyzed} analyzed / ${data.metadata.vulnerabilityAnalysis.total} total\n`);
});

console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
console.log('â•‘     OVERALL RISK DISTRIBUTION                              â•‘');
console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
console.log(`  ğŸ”´ CRITICAL risk: ${totalCritical} plugins`);
console.log(`  ğŸŸ  HIGH risk: ${totalHigh} plugins`);
console.log(`  ğŸŸ¡ MEDIUM risk: ${totalMedium} plugins`);
console.log(`  ğŸŸ¢ LOW risk: ${totalLow} plugins`);
console.log(`  âœ… CLEAN: ${totalClean} plugins\n`);

const analyzed = totalCritical + totalHigh + totalMedium + totalLow + totalClean;
console.log(`Total analyzed: ${analyzed} / 900 plugins (${(analyzed/900*100).toFixed(1)}%)\n`);














