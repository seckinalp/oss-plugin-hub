# Vulnerability Data Structure in top100.json

All plugins in `data/{platform}/top100.json` files now include enhanced `vulnerabilityAnalysis` field with comprehensive security information including risk descriptions and time-categorized stale packages.

## Data Coverage

- **Total plugins**: 900
- **With vulnerability analysis**: 619 (68.8%)
- **SBOM available but not scanned**: 113 (12.6%)
- **No SBOM available**: 168 (18.7%)
- **No GitHub repository**: 0 (0.0%)

## Enhanced Data Structure

### For Analyzed Plugins (status: "analyzed")

```json
{
  "name": "Code Runner",
  "repo": "formulahendry/vscode-code-runner",
  "vulnerabilityAnalysis": {
    "status": "analyzed",
    "analyzed": true,
    "analyzedAt": "2025-12-17T20:07:21.171Z",
    "summary": {
      "totalVulnerabilities": 18,
      "criticalVulnerabilities": 0,
      "highVulnerabilities": 1,
      "mediumVulnerabilities": 0,
      "lowVulnerabilities": 17,
      "stalePackages": 18,
      "stalePackages6Months": 6,
      "stalePackages1Year": 6,
      "stalePackages2Years": 3,
      "stalePackages3YearsPlus": 1,
      "recentVulnerabilities": 1
    },
    "riskLevel": "high",
    "riskDescription": "Contains 1 HIGH severity vulnerability(ies) that pose significant security risks. These issues should be prioritized for remediation as they can lead to serious security breaches."
  }
}
```

### For Plugins Without SBOM (status: "no_sbom")

```json
{
  "name": "uBlock Origin",
  "repo": "gorhill/uBlock",
  "vulnerabilityAnalysis": {
    "status": "no_sbom",
    "message": "SBOM not available from GitHub (repository has no analyzable dependencies or uses unsupported package manager)",
    "analyzed": false
  }
}
```

## Risk Levels with Descriptions

| Risk Level | Description | Criteria | Count |
|------------|-------------|----------|-------|
| **üî¥ CRITICAL** | Contains CRITICAL severity vulnerabilities that pose immediate security risks and should be addressed urgently. These vulnerabilities have severe impacts and are often actively exploited. | Has 1+ CRITICAL vulnerabilities | 2 |
| **üü† HIGH** | Contains HIGH severity vulnerabilities that pose significant security risks. These issues should be prioritized for remediation as they can lead to serious security breaches. | Has 1+ HIGH vulnerabilities (no CRITICAL) | 20 |
| **üü° MEDIUM** | Contains MEDIUM severity vulnerabilities that present moderate security concerns. While not immediately critical, these should be addressed in regular security updates. | Has 1+ MEDIUM vulnerabilities (no HIGH/CRITICAL) | 153 |
| **üü¢ LOW** | Contains LOW severity vulnerabilities with minimal security impact. These are less urgent but should still be tracked and resolved during routine maintenance. | Has only LOW severity vulnerabilities | 131 |
| **‚úÖ CLEAN** | No known vulnerabilities detected in dependencies. This indicates good security hygiene, though regular monitoring is still recommended. | Zero vulnerabilities | 313 |

## Stale Packages Time Categories

Stale packages are now categorized by how long fixes have been available:

| Category | Time Range | Urgency | Count |
|----------|-----------|---------|-------|
| **stalePackages6Months** | 6-12 months | ‚ö†Ô∏è Warning | 1,573 |
| **stalePackages1Year** | 1-2 years | üü° Moderate | 1,541 |
| **stalePackages2Years** | 2-3 years | üü† High | 529 |
| **stalePackages3YearsPlus** | 3+ years | üî¥ Critical | 69 |

**Total stale packages across all platforms**: 3,712

### Stale Packages by Platform

```
chrome:
  ‚ö†Ô∏è  6-12 months: 290 packages
  üü° 1-2 years: 324 packages
  üü† 2-3 years: 131 packages
  üî¥ 3+ years: 19 packages
  Total: 764 packages

firefox:
  ‚ö†Ô∏è  6-12 months: 216 packages
  üü° 1-2 years: 249 packages
  üü† 2-3 years: 90 packages
  üî¥ 3+ years: 6 packages
  Total: 561 packages

homeassistant:
  ‚ö†Ô∏è  6-12 months: 264 packages
  üü° 1-2 years: 242 packages
  üü† 2-3 years: 63 packages
  üî¥ 3+ years: 4 packages
  Total: 573 packages

jetbrains:
  ‚ö†Ô∏è  6-12 months: 6 packages
  üü° 1-2 years: 4 packages
  üü† 2-3 years: 3 packages
  üî¥ 3+ years: 0 packages
  Total: 13 packages

minecraft:
  ‚ö†Ô∏è  6-12 months: 39 packages
  üü° 1-2 years: 11 packages
  üü† 2-3 years: 0 packages
  üî¥ 3+ years: 0 packages
  Total: 50 packages

obsidian:
  ‚ö†Ô∏è  6-12 months: 235 packages
  üü° 1-2 years: 189 packages
  üü† 2-3 years: 22 packages
  üî¥ 3+ years: 0 packages
  Total: 446 packages

sublime:
  ‚ö†Ô∏è  6-12 months: 31 packages
  üü° 1-2 years: 26 packages
  üü† 2-3 years: 26 packages
  üî¥ 3+ years: 8 packages
  Total: 91 packages

vscode:
  ‚ö†Ô∏è  6-12 months: 234 packages
  üü° 1-2 years: 217 packages
  üü† 2-3 years: 98 packages
  üî¥ 3+ years: 13 packages
  Total: 562 packages

wordpress:
  ‚ö†Ô∏è  6-12 months: 258 packages
  üü° 1-2 years: 279 packages
  üü† 2-3 years: 96 packages
  üî¥ 3+ years: 19 packages
  Total: 652 packages
```

## Complete Field Reference

### vulnerabilityAnalysis Object

```typescript
interface VulnerabilityAnalysis {
  // Status fields
  status: 'analyzed' | 'no_sbom' | 'not_scanned' | 'scan_failed' | 'no_repo';
  analyzed: boolean;
  analyzedAt?: string; // ISO timestamp
  
  // Summary (only for analyzed plugins)
  summary?: {
    totalVulnerabilities: number;
    criticalVulnerabilities: number;
    highVulnerabilities: number;
    mediumVulnerabilities: number;
    lowVulnerabilities: number;
    stalePackages: number;
    stalePackages6Months: number;    // Fixes available 6-12 months
    stalePackages1Year: number;       // Fixes available 1-2 years
    stalePackages2Years: number;      // Fixes available 2-3 years
    stalePackages3YearsPlus: number;  // Fixes available 3+ years
    recentVulnerabilities: number;
  };
  
  // Risk assessment (only for analyzed plugins)
  riskLevel?: 'critical' | 'high' | 'medium' | 'low' | 'clean';
  riskDescription?: string;
  
  // Message (for non-analyzed plugins)
  message?: string;
}
```

## Usage Examples

### Query by Risk Level

```javascript
const fs = require('fs');
const data = JSON.parse(fs.readFileSync('data/vscode/top100.json', 'utf8'));

// Find all high-risk plugins
const highRisk = data.top100.filter(p => 
  ['critical', 'high'].includes(p.vulnerabilityAnalysis?.riskLevel)
);

console.log(`Found ${highRisk.length} high-risk plugins`);
highRisk.forEach(p => {
  console.log(`- ${p.name}: ${p.vulnerabilityAnalysis.riskDescription}`);
});
```

### Find Plugins with Very Old Stale Packages

```javascript
// Find plugins with packages that haven't been updated in 3+ years
const veryStale = data.top100.filter(p => 
  (p.vulnerabilityAnalysis?.summary?.stalePackages3YearsPlus || 0) > 0
);

console.log(`${veryStale.length} plugins have dependencies with fixes available for 3+ years`);
```

### Analyze Stale Package Distribution

```javascript
const analyzed = data.top100.filter(p => p.vulnerabilityAnalysis?.analyzed);

const staleStats = {
  sixMonths: 0,
  oneYear: 0,
  twoYears: 0,
  threePlus: 0,
};

analyzed.forEach(p => {
  const s = p.vulnerabilityAnalysis.summary;
  staleStats.sixMonths += s.stalePackages6Months || 0;
  staleStats.oneYear += s.stalePackages1Year || 0;
  staleStats.twoYears += s.stalePackages2Years || 0;
  staleStats.threePlus += s.stalePackages3YearsPlus || 0;
});

console.log('Stale Package Distribution:');
console.log(`  6-12 months: ${staleStats.sixMonths}`);
console.log(`  1-2 years: ${staleStats.oneYear}`);
console.log(`  2-3 years: ${staleStats.twoYears}`);
console.log(`  3+ years: ${staleStats.threePlus}`);
```

### Generate Risk Report

```javascript
const riskCounts = {
  critical: 0,
  high: 0,
  medium: 0,
  low: 0,
  clean: 0,
};

data.top100.forEach(p => {
  const level = p.vulnerabilityAnalysis?.riskLevel;
  if (level) riskCounts[level]++;
});

console.log('Risk Distribution:');
Object.entries(riskCounts).forEach(([level, count]) => {
  console.log(`  ${level}: ${count}`);
});
```

## Metadata Added to Each top100.json

```json
{
  "metadata": {
    "lastVulnerabilityUpdate": "2025-12-17T20:30:00.000Z",
    "vulnerabilityAnalysis": {
      "total": 100,
      "analyzed": 88,
      "noSbom": 3,
      "notScanned": 9,
      "noRepo": 0
    }
  }
}
```

## Updating the Data

To refresh vulnerability data with enhanced analysis:

```bash
# 1. Fetch new SBOMs (if needed)
npm run fetch-sbom

# 2. Scan with OSV
npm run scan-osv -- --docker

# 3. Analyze vulnerabilities
npm run analyze-vulnerabilities

# 4. Enrich top100.json files (with enhanced data)
npm run enrich-vulnerability-data

# 5. Generate summary
npm run vulnerability-summary
```

## Interpreting Stale Package Ages

### ‚ö†Ô∏è 6-12 Months (stalePackages6Months)
- **Urgency**: Moderate
- **Action**: Should be updated in next maintenance cycle
- **Risk**: May contain known vulnerabilities with available fixes

### üü° 1-2 Years (stalePackages1Year)
- **Urgency**: High
- **Action**: Should be prioritized for update
- **Risk**: Likely contains multiple known vulnerabilities

### üü† 2-3 Years (stalePackages2Years)
- **Urgency**: Very High
- **Action**: Requires immediate attention
- **Risk**: Significant security exposure from outdated dependencies

### üî¥ 3+ Years (stalePackages3YearsPlus)
- **Urgency**: Critical
- **Action**: Emergency update required
- **Risk**: Severe security exposure, may be actively exploited

## Why Some Plugins Don't Have Analysis

### No SBOM Available (168 plugins)

Reasons:
1. Repository has no dependencies
2. Uses unsupported package manager (GitHub supports: npm, pip, Ruby, Go, etc.)
3. Private repository
4. GitHub hasn't generated dependency graph yet
5. Repository is archived or deleted

**Examples:**
- `gorhill/uBlock` - Uses custom build system
- `facebook/react` - Monorepo with complex structure
- Many browser extensions use pure HTML/CSS/JS with no package.json

### Not Yet Scanned (113 plugins)

These have SBOMs but haven't been scanned with OSV yet. Run:

```bash
npm run scan-osv -- --docker
npm run analyze-vulnerabilities
npm run enrich-vulnerability-data
```

## Related Files

- **Analysis files**: `data/osv-scans/*.analysis.json`
- **OSV scans**: `data/osv-scans/*.osv.json`
- **SBOMs**: `data/sbom/*.sbom.json`
- **Summary**: `data/vulnerability-summary.json`

## Scripts

- `npm run enrich-vulnerability-data` - Add enhanced vulnerability data to top100.json files
- `npm run vulnerability-summary` - Generate overall vulnerability summary
- `npm run scan-osv` - Scan SBOMs with OSV scanner
- `npm run analyze-vulnerabilities` - Analyze OSV scan results with time categorization
- `npm run view-vulnerability-report <plugin>` - View detailed report for a plugin
- `node scripts/show-vulnerability-summary.js` - Display risk distribution summary














